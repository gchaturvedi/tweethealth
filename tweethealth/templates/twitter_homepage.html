{% extends "base.html" %}
{% block js %}
{{ block.super }}
<script type="text/javascript">
	$(document).ready(function() {
		$('#twitter-block').hide();
		twitterUpdate();
		window.setInterval(twitterUpdate, 600000);
		function twitterUpdate() { 
	        $.ajax({
		        type: "POST",
		        url: '/twitter/update-timeline/',
				data: { 'csrfmiddlewaretoken': '{{csrf_token}}'},
		        success:  function(data) {
					if(data['twitter_error']) {
						$('.tweet-score-container').hide();
						$('.latest-tweet').hide();
						$('.waiting-block').hide();
						$('.twitter-block').show();
						$('.tweet-button-container').hide();
						$('.twitter-block').text('Unable to fetch Twitter data.  Please try again later.');
					}
					else {
						$('.tweet-score').text(data['health_rating']);
						$('.health-msg').text(data['health_msg']);
						$('.latest-tweet').text(data['latest_tweet']);
						$('.waiting-block').hide();
						$('.twitter-block').show();
					}
		        },
		        error: function(data) {
					// Insert error processing here if necessary
		        }	
			});		
		}
	});
</script>
{% endblock %}
{% block navbar %}
<ul class="nav">
  <li class="active">
    <a href="/">Home</a>
  </li>
  <li><a href="/about/">About TweetHealth</a></li>
</ul>
{% endblock %}
{% block content %}
  <h1>Welcome @{{ twitter_username }}</h1>
  <p>Your score is based on a combination of analyzing your tweets and followers.</p>
	<div class="waiting-block" align="center">
	<img class="spinner" src="/media/img/spinner_waiting.gif">
	<p> Loading Twitter Content..</p>
	</div>
	<div class="twitter-block" align="center">
		<div class="tweet-score-container">
			<h3>TweetHealth score</h3>
			<div align="center" class="alert alert-info tweet-score-box">
				<p class="tweet-score">...</p>
			</div>
		</div>
		<div class="meaning-block">
		<h3 style="">What is the meaning of this?</h3>
		<p class="health-msg">...</p>		
		</div>
	</div>
	<div class="tweet-button-container" align="center">
	<p class="latest-tweet"></p>
    <a style="margin-top:20px;" class="btn btn-primary btn-large">
		Tweet your TweetHealth rating!
    </a>
	</div>
</div>
{% endblock %}
